[uwsgi]
# configure one uwsgi instance
# uses upstart for control

# Network configurations
socket = /tmp/{{ app_name }}-{{ item }}.sock
# make sure that nginx will be able to read-write the socket
chmod-socket = 664
chown-socket = www-data:www-data

# header buffer, default 4k
buffer-size: 8192

# Environment configurations
uid = ubuntu
gid = ubuntu
master = true
virtualenv = {{ venv_dir }}
module = {{ uwsgi_module }}
thunder-lock = enabled

# Multiprocessing configurations
processes = {{ uwsgi.processes }}
{% if uwsgi.gevent is defined %}
gevent-monkey-patch
gevent = {{ uwsgi.gevent.workers }}
{% endif %}

# Logging configurations
# ssl-verbose is a debug-level log option
log-syslog = uwsgi_{{ app_name }}
log-format = [%(ltime)] [{{ ansible_eth0.ipv4.address }}] [%(addr)] [%(status)] [%(proto)] [%(method)] [%(micros)] [%(rsize)] [%(uri)] [] [] [%(uagent)]

#Diagnostics and Monitoring configurations
memory-report = true
stats = 127.0.0.1:97{{ item }}
{% if uwsgi.max_requests is defined %}
# Automatically restart processes after this many requests
max-requests = {{ uwsgi.max_requests }}
{% endif %}